<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swiper nested</title>
  <style>
    body {
      margin: 0;
      background-color: #d9f81c;
      background-image:
        radial-gradient(at 47% 33%, hsl(187.59, 100%, 48%) 0, transparent 59%),
        radial-gradient(at 82% 65%, hsl(98.78, 100%, 50%) 0, transparent 55%);
      background-attachment: fixed;
    }

    .container {
      font-size: clamp(12px, 1.5vw, 15px);
    }

    .nav_container {
      display: none;
    }

    .swiper-slide {
      /* for sub-navigation */
      position: relative;
      display: grid;
      place-items: center;
      font-size: clamp(48px, 6.4vw, 64px);
      width: 100%;
      max-width: 100%;
    }

    .swiper-slide.outer:not(:has(.inner)),
    .swiper-slide.inner {
      box-sizing: border-box;
      padding-inline: 32px;
      height: 100vh;
      height: 100dvh;
      word-break: break-all;
    }

    .sub-navigation {
      display: none;
    }

    @media screen and (min-width: 480px) {
      .container {
        display: grid;
        grid-template-columns: minmax(max-content, 20vw) 1fr;
        grid-template-rows: 100vh;
      }

      .nav_container {
        display: grid;
        place-items: center;
        padding-inline: 1em;
        /* Glassmorphism effect */
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        backdrop-filter: blur(16px) saturate(180%);
        background-color: rgba(255, 255, 255, 0.5);
        /* Generated by https://generator.ui.glass/ */
      }

      .slide_container {
        overflow-y: hidden;
      }

      .swiper,
      .swiper.child {
        height: 100%;
      }

      .swiper.child {
        width: 100%;
        overflow-y: hidden;
      }

      .swiper-wrapper {
        height: 100%;
      }

      /* pagination */
      .main-navigation {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

      .main-navigation .swiper-pagination-bullet {
        text-align: center;
      }

      .main-navigation .swiper-pagination-bullet-active {
        text-decoration: underline;
      }

      .sub-navigation {
        position: absolute;
        top: 50%;
        right: 8px;
        transform: translateY(-50%);
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .sub-navigation .swiper-pagination-bullet {
        width: 14px;
        aspect-ratio: 1;
        background-color: white;
        border: 1px solid black;
        border-radius: calc(infinity * 1px);
      }

      .sub-navigation .swiper-pagination-bullet-active {
        background-color: black;
      }
    }
  </style>
  <script type="module">
    import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.mjs'

    const BREAKPOINT = 480
    // メインのページネーション用ラベル
    const LABEL = ['Category 1', 'Category 2', 'Category 3', 'Category 4']

    // Swiperのセットアップ用関数
    const setup = () => {
      // メインのSwiper
      const parent = new Swiper('.swiper.parent', {
        // init: false,
        direction: 'vertical',
        // enabled: false,
        mousewheel: true,
        pagination: {
          el: ".main-navigation",
          type: 'bullets',
          clickable: true,
          renderBullet: (index, className) => {
            return `<span class="${className}">${LABEL[index]}</span>`
          },
        },
      })

      // 入れ子のSwiper（セレクタで選択されたすべての要素に設定される）
      const children = new Swiper('.swiper.child', {
        // init: false,
        direction: 'vertical',
        // enabled: false,
        mousewheel: true,
        nested: true, // これがないと入れ子要素のスライドができない
        pagination: {
          el: '.sub-navigation',
          clickable: true,
        },
      })

      // メインのページネーションの bullet に追加でクリックイベントを設定
      parent.pagination.bullets.filter((_, index) => {
        // 子Swiperがあるスライドと同じ index の bullet のみに限定
        return parent.slides[index].querySelector('.swiper.child')
      }).forEach((bullet, index) => {
        bullet.addEventListener('click', () => {
          // 子Swiperを先頭へもどす
          children[index].slideTo(0)
        })
      })

      // 全Swiper再起動メソッド
      // 公式の方法がなくて…完全かどうか不明
      const enable = () => {
        [parent, ...children].forEach((swiper) => {
          delete swiper.destroyed
          swiper.pagination.init()
          // 手動で再登録してやらないとページネーションが更新されない(マジで?)
          swiper.on('slideChange', () => {
            swiper.pagination.update()
          })
          swiper.init()
          swiper.mousewheel.enable()
          swiper.pagination.update()
        })
      }

      // 全Swiper破棄メソッド
      const disable = (deleteInstance = true) => {
        [parent, ...children].forEach((swiper) => {
          swiper.destroy(deleteInstance)
          // mousewheel は destroy(false) では無効にならないので手動で無効化
          !deleteInstance && swiper.mousewheel.disable()
        })
      }

      return { parent, children, enable, disable }
    }

    const swiper = setup()

    // ブレークポイントで Swiper の有効・無効を切り替える
    const mediaQuery = window.matchMedia(`(min-width: ${BREAKPOINT}px)`)
    const toggleSwiper = (mq) => {
      const { parent } = swiper
      if (mq.matches) {
        // Swiperを完全に作成しなおす場合は、コメントアウト行を有効にして
        // 現在、実行されている行をコメントアウトする
        // (ちなみに、この destroyed プロパティはドキュメントにのってない)
        if (parent.destroyed) {
          // Object.assign(swiper, setup())
          swiper.enable()
        }
      } else {
        // swiper.disable()
        swiper.disable(false)
      }
    }
    toggleSwiper(mediaQuery)
    mediaQuery.addListener(toggleSwiper)

  </script>
</head>

<body>
  <div class="container">
    <aside class="nav_container">
      <nav class="main-navigation"></nav>
    </aside>
    <main class="slide_container">
      <section class="swiper parent">
        <div class="swiper-wrapper">
          <div class="swiper-slide outer">
            <article class="swiper child">
              <div class="swiper-wrapper">
                <div class="swiper-slide inner">Category 1-1</div>
                <div class="swiper-slide inner">Category 1-2</div>
              </div>
              <nav class="sub-navigation"></nav>
            </article>
          </div>
          <div class="swiper-slide outer">Category 2</div>
          <div class="swiper-slide outer">
            <article class="swiper child">
              <div class="swiper-wrapper">
                <div class="swiper-slide inner">Category 3-1</div>
                <div class="swiper-slide inner">Category 3-2</div>
                <div class="swiper-slide inner">Category 3-3</div>
              </div>
              <nav class="sub-navigation"></nav>
            </article>
          </div>
          <div class="swiper-slide outer">Category 4</div>
        </div>
      </section>
    </main>
  </div>
</body>

</html>